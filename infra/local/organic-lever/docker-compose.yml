# Local Development Environment for Organic Lever Backend
# This setup provides Docker-based development with auto-reload via Spring Boot DevTools

services:
  organic-lever-be:
    image: eclipse-temurin:25-jdk-alpine
    container_name: organic-lever-be
    working_dir: /workspace

    # Mount full source code for development
    volumes:
      - ../../../apps/organic-lever-be:/workspace:rw

    ports:
      - "8100:8100"

    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - SERVER_PORT=8100
      - MAVEN_OPTS=${MAVEN_OPTS:--Xmx512m}

    # Install Maven and run with DevTools for auto-reload
    command: >
      sh -c "apk add --no-cache maven &&
             mvn org.springframework.boot:spring-boot-maven-plugin:run -Dspring-boot.run.profiles=dev"

    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8100/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s # Extended for Maven dependency download on first run

    restart: unless-stopped
    networks:
      - organic-lever-network

networks:
  organic-lever-network:
    driver: bridge
    name: organic-lever-network

# Future services can be added here:
# organic-lever-fe:
#   image: nginx:alpine
#   container_name: organic-lever-fe
#   ports:
#     - "3100:80"
#   networks:
#     - organic-lever-network
#
# organic-lever-db:
#   image: postgres:16-alpine
#   container_name: organic-lever-db
#   environment:
#     - POSTGRES_DB=organic_lever
#     - POSTGRES_USER=${DB_USER:-organic_lever}
#     - POSTGRES_PASSWORD=${DB_PASSWORD:-changeme}
#   volumes:
#     - organic-lever-db-data:/var/lib/postgresql/data
#   ports:
#     - "5432:5432"
#   networks:
#     - organic-lever-network
#
# volumes:
#   organic-lever-db-data:
